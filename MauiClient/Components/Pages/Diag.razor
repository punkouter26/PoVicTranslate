@page "/diag"
@inject MauiClient.Services.TranslationApiService TranslationApiService
<PageTitle>Diagnostics</PageTitle>

<h2>System Diagnostics</h2>

<div class="diagnostics-container">
    <button class="btn btn-secondary mb-3" @onclick="RunDiagnostics" disabled="IsChecking">@((IsChecking ? "Checking..." : "Run Diagnostics"))</button>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Check</th>
                <th>Status</th>
                <th>Message</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>API Connectivity</td>
                <td>
                    @if (ApiStatus == true)
                    {
                        <span style="color:green; font-weight:bold;">✔</span>
                    }
                    else if (ApiStatus == false)
                    {
                        <span style="color:red; font-weight:bold;">✖</span>
                    }
                </td>
                <td>@ApiMessage</td>
            </tr>
        </tbody>
    </table>
    <a href="/" class="btn btn-link">Back to Main Page</a>
</div>

@code {
    private bool? ApiStatus = null;
    private string ApiMessage = string.Empty;
    private bool IsChecking = false;

    private async Task RunDiagnostics()
    {
        IsChecking = true;
        ApiStatus = null;
        ApiMessage = string.Empty;
        try
        {
            // Try a simple translation call with dummy text
            var result = await TranslationApiService.TranslateToVictorianEnglishAsync("Hello");
            ApiStatus = !string.IsNullOrWhiteSpace(result);
            ApiMessage = ApiStatus == true ? "API reachable and returned translation." : "API returned empty result.";
        }
        catch (Exception ex)
        {
            ApiStatus = false;
            ApiMessage = $"API error: {ex.Message}";
        }
        finally
        {
            IsChecking = false;
        }
    }
} 