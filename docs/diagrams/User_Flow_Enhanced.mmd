```mermaid
flowchart TD
    Start([User Opens App]) --> LoadCheck{First Time<br/>User?}
    
    LoadCheck -->|Yes| Welcome[Show Welcome Animation<br/>Detect Theme Preference]
    LoadCheck -->|No| LoadPrefs[Load User Preferences<br/>Theme, Last Section Used]
    
    Welcome --> MainScreen
    LoadPrefs --> MainScreen[Main Screen Displayed]
    
    MainScreen --> UserIntent{What does<br/>user want?}
    
    UserIntent -->|Random Song| ClickRandom[Click Random Button]
    UserIntent -->|Specific Song| UseSearch[Use Smart Search]
    UserIntent -->|Custom Text| WriteOwn[Write Custom Text]
    UserIntent -->|Previous Work| OpenHistory[Open History Drawer]
    
    %% Random Song Flow
    ClickRandom --> ShowPreview[Show Song Preview Card<br/>✨ NEW: Preview before commit]
    ShowPreview --> PreviewDecision{Like this<br/>song?}
    PreviewDecision -->|Yes| AcceptSong[Click Use This]
    PreviewDecision -->|No| ClickRandom
    AcceptSong --> LoadSong[Load Song into Input]
    LoadSong --> ReadyToTranslate
    
    %% Smart Search Flow
    UseSearch --> TypeSearch[Start Typing Song Name<br/>✨ NEW: Real-time filtering]
    TypeSearch --> ShowResults[Show Top 5 Matches<br/>Highlight matching text]
    ShowResults --> SearchDecision{Found it?}
    SearchDecision -->|Yes| SelectFromSearch[Click or Press Enter]
    SearchDecision -->|No| TypeSearch
    SelectFromSearch --> LoadSong
    
    %% Custom Text Flow
    WriteOwn --> OpenCustomSection[Open Custom Input Section<br/>✨ NEW: Auto-collapse song section]
    OpenCustomSection --> TypeText[Type or Paste Text]
    TypeText --> WatchProgress[✨ NEW: Watch Progress Ring<br/>Visual feedback on limit]
    WatchProgress --> TextReady{Text<br/>ready?}
    TextReady -->|Too long| EditText[Edit to fit 200 words]
    TextReady -->|Clear & start over| SwipeClear[✨ NEW: Swipe left to clear]
    TextReady -->|Ready| ReadyToTranslate
    EditText --> TypeText
    SwipeClear --> TypeText
    
    %% History Flow
    OpenHistory --> ShowHistory[✨ NEW: Show Last 5 Translations<br/>Side drawer slides in]
    ShowHistory --> HistoryAction{What to do?}
    HistoryAction -->|Reload| ClickHistory[Click history item]
    HistoryAction -->|Delete| SwipeDelete[✨ NEW: Swipe to delete]
    HistoryAction -->|Close| CloseDrawer[Close drawer]
    ClickHistory --> LoadHistoryItem[Load input & output]
    LoadHistoryItem --> ReviewResult
    SwipeDelete --> ShowHistory
    CloseDrawer --> MainScreen
    
    %% Translation Flow
    ReadyToTranslate[Ready to Translate] --> TranslateAction{How to<br/>translate?}
    TranslateAction -->|Desktop| ClickButton[Click Translate Button]
    TranslateAction -->|Mobile| UseFAB[✨ NEW: Tap FAB<br/>No scrolling needed!]
    
    ClickButton --> Processing
    UseFAB --> Processing[Processing...<br/>Show loading spinner]
    
    Processing --> Success{Translation<br/>successful?}
    Success -->|Yes| ShowResult[Display Result<br/>Animate in]
    Success -->|No| ShowError[Show Error Message<br/>✨ Better formatting]
    
    ShowError --> UserIntent
    
    %% Result Actions
    ShowResult --> ReviewResult[Review Translation]
    ReviewResult --> ResultAction{What<br/>next?}
    
    ResultAction -->|Copy| ClickCopy[Click Copy Button<br/>✨ NEW: Animated feedback]
    ResultAction -->|Edit| DoubleClick[✨ NEW: Double-click to edit]
    ResultAction -->|Listen| ClickSpeak[Click Speak Button]
    ResultAction -->|Share| ShareAction[Future: Share feature]
    ResultAction -->|New| NewTranslation[Start new translation]
    
    ClickCopy --> ShowToast[✨ NEW: Toast notification<br/>Copied! with checkmark]
    ShowToast --> SaveHistory[✨ NEW: Auto-save to history]
    SaveHistory --> ResultAction
    
    DoubleClick --> EditMode[✨ NEW: Enter edit mode<br/>Editable textarea]
    EditMode --> EditActions{Action?}
    EditActions -->|Save| SaveEdits[Save changes]
    EditActions -->|Cancel| CancelEdit[Cancel & revert]
    EditActions -->|Re-translate| TranslateEdited[Translate edited version]
    SaveEdits --> ShowResult
    CancelEdit --> ShowResult
    TranslateEdited --> Processing
    
    ClickSpeak --> PlayAudio[Play Audio<br/>Show visualizer]
    PlayAudio --> ResultAction
    
    NewTranslation --> ClearAction{How to<br/>clear?}
    ClearAction -->|Button| ClickClear[Click clear button]
    ClearAction -->|Gesture| SwipeResult[✨ NEW: Swipe right on result]
    ClickClear --> MainScreen
    SwipeResult --> MainScreen
    
    %% Theme Toggle
    MainScreen -.->|Anytime| ThemeSwitch[✨ NEW: Toggle Theme<br/>Dark ↔ Light]
    ThemeSwitch --> SaveTheme[Save preference]
    SaveTheme --> MainScreen
    
    style Start fill:#ffd700,stroke:#ff8c00,stroke-width:3px
    style ShowPreview fill:#ff6b6b,stroke:#c92a2a,stroke-width:3px,color:#fff
    style TypeSearch fill:#ff6b6b,stroke:#c92a2a,stroke-width:3px,color:#fff
    style WatchProgress fill:#ff6b6b,stroke:#c92a2a,stroke-width:3px,color:#fff
    style UseFAB fill:#ff6b6b,stroke:#c92a2a,stroke-width:3px,color:#fff
    style ShowHistory fill:#ffd43b,stroke:#fab005,stroke-width:2px
    style EditMode fill:#00aaff,stroke:#0088cc,stroke-width:2px,color:#fff
    style SwipeClear fill:#00ff88,stroke:#00cc66,stroke-width:2px
    style SwipeResult fill:#00ff88,stroke:#00cc66,stroke-width:2px
    style ShowToast fill:#51cf66,stroke:#2f9e44,stroke-width:2px
    
    classDef newFeature fill:#51cf66,stroke:#2f9e44,stroke-width:2px
    classDef improved fill:#339af0,stroke:#1971c2,stroke-width:2px
    classDef decision fill:#ffd43b,stroke:#fab005,stroke-width:2px
    
    class ShowPreview,TypeSearch,ShowResults,WatchProgress,UseFAB,ShowHistory,EditMode,SwipeClear,SwipeResult,ShowToast,ThemeSwitch newFeature
    class ClickCopy,ShowError improved
```
