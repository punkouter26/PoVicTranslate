flowchart TD
    Start([User Opens Application]) --> Landing[Translation Page Loads]
    
    Landing --> Decision{Choose Input Method}
    
    Decision -->|Manual Entry| Manual[Enter Text in Textarea]
    Decision -->|Pre-loaded Content| Library[Select from Lyrics Library]
    
    Library --> LoadLyrics[Load Selected Lyrics]
    LoadLyrics --> Validate
    
    Manual --> Validate{Validate Input}
    
    Validate -->|Empty Text| EmptyError[Show: Please enter some text]
    Validate -->|Over 200 Words| LimitError[Show: Reduce to 200 words or less]
    Validate -->|Valid Input| Processing[Start Translation Process]
    
    EmptyError --> Decision
    LimitError --> Decision
    
    Processing --> ShowLoader[Show Loading Spinner]
    ShowLoader --> APICall[Call Translation API]
    
    APICall --> APISuccess{API Response}
    
    APISuccess -->|Success| DisplayResult[Display Victorian Translation]
    APISuccess -->|Error| TranslationError[Show: Translation error occurred]
    
    TranslationError --> Decision
    
    DisplayResult --> ResultActions{User Actions}
    
    ResultActions -->|Copy Text| CopyClipboard[Copy to Clipboard]
    ResultActions -->|Play Audio| TTSProcess[Text-to-Speech Process]
    ResultActions -->|New Translation| Decision
    ResultActions -->|View Diagnostics| DiagPage[Navigate to Diagnostics]
    
    CopyClipboard --> CopySuccess[Show: Copied to clipboard]
    CopySuccess --> ResultActions
    
    TTSProcess --> TTSLoader[Show Audio Loading]
    TTSLoader --> SpeechAPI[Call Speech Synthesis API]
    
    SpeechAPI --> SpeechResult{Speech API Response}
    
    SpeechResult -->|Success| PlayAudio[Play Audio in Browser]
    SpeechResult -->|Error| SpeechError[Show: Text-to-speech error]
    
    PlayAudio --> AudioEnd[Audio Playback Complete]
    SpeechError --> ResultActions
    AudioEnd --> ResultActions
    
    %% Diagnostic Flow
    DiagPage --> CheckHealth[Check System Health]
    CheckHealth --> HealthStatus{Health Check Results}
    
    HealthStatus -->|Healthy| ShowHealthy[Display: All Systems Operational]
    HealthStatus -->|Issues| ShowIssues[Display: Service Issues Detected]
    
    ShowHealthy --> DiagActions{Diagnostic Actions}
    ShowIssues --> DiagActions
    
    DiagActions -->|View Logs| ShowLogs[Display Recent Debug Logs]
    DiagActions -->|Test API| TestEndpoints[Manual API Testing]
    DiagActions -->|Return| Landing
    
    ShowLogs --> DiagActions
    TestEndpoints --> DiagActions
    
    %% Error Handling Flows
    subgraph "Error Handling"
        ErrorPage[Error Page]
        ErrorInfo[Display Error Information]
        ErrorActions{Error Recovery Options}
        RetryAction[Retry Operation]
        GoHome[Return to Main Page]
        
        ErrorPage --> ErrorInfo
        ErrorInfo --> ErrorActions
        ErrorActions --> RetryAction
        ErrorActions --> GoHome
        RetryAction --> Decision
        GoHome --> Landing
    end
    
    %% Debug Logging (Background Process)
    subgraph "Background Logging"
        UserAction[Any User Action]
        LogEvent[Log to Debug System]
        BrowserLog[Browser Console Capture]
        ServerLog[Server-side Logging]
        
        UserAction --> LogEvent
        LogEvent --> BrowserLog
        LogEvent --> ServerLog
    end
    
    %% Connect error scenarios
    TranslationError -.->|Severe Error| ErrorPage
    SpeechError -.->|Severe Error| ErrorPage
    
    %% Connect all user actions to logging
    Manual -.-> UserAction
    Library -.-> UserAction
    Processing -.-> UserAction
    CopyClipboard -.-> UserAction
    TTSProcess -.-> UserAction
    
    %% Styling
    classDef userAction fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef systemProcess fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef errorState fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    classDef successState fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef decision fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    
    class Start,Landing,Manual,Library,CopyClipboard,TTSProcess,DiagPage userAction
    class Processing,ShowLoader,APICall,DisplayResult,TTSLoader,SpeechAPI,PlayAudio,CheckHealth,ShowLogs,TestEndpoints systemProcess
    class EmptyError,LimitError,TranslationError,SpeechError,ErrorPage,ErrorInfo errorState
    class CopySuccess,AudioEnd,ShowHealthy successState
    class Decision,Validate,APISuccess,ResultActions,SpeechResult,HealthStatus,DiagActions,ErrorActions decision
