@* Inline Edit Mode Component *@

<div class="edit-mode-container" @ondblclick="OnDoubleClick">
    @if (!IsEditMode)
    {
        <!-- Display Mode -->
        <div class="display-mode" role="region" aria-label="Translated text (double-click to edit)">
            @if (!string.IsNullOrWhiteSpace(Text))
            {
                <div class="display-text">@Text</div>
                <div class="edit-hint">
                    <span class="hint-icon">‚úèÔ∏è</span>
                    <span class="hint-text">Double-click to edit</span>
                </div>
            }
            else
            {
                <div class="empty-text">No translation yet</div>
            }
        </div>
    }
    else
    {
        <!-- Edit Mode -->
        <div class="edit-mode" role="region" aria-label="Edit translated text">
            <div class="edit-header">
                <span class="edit-icon">‚úèÔ∏è</span>
                <span class="edit-label">Editing Translation</span>
            </div>

            <textarea
                class="edit-textarea"
                @bind="EditedText"
                @bind:event="oninput"
                rows="6"
                placeholder="Edit your translation..."
                aria-label="Translation editor"
                autofocus
            ></textarea>

            <div class="edit-actions">
                <button 
                    class="edit-btn save-btn"
                    @onclick="OnSave"
                    disabled="@string.IsNullOrWhiteSpace(EditedText)"
                    aria-label="Save changes">
                    <span class="btn-icon">‚úì</span>
                    <span class="btn-text">Save</span>
                </button>

                <button 
                    class="edit-btn cancel-btn"
                    @onclick="OnCancel"
                    aria-label="Cancel editing">
                    <span class="btn-icon">‚úï</span>
                    <span class="btn-text">Cancel</span>
                </button>

                @if (ShowRetranslate)
                {
                    <button 
                        class="edit-btn retranslate-btn"
                        @onclick="OnRetranslate"
                        aria-label="Retranslate original text">
                        <span class="btn-icon">üîÑ</span>
                        <span class="btn-text">Re-translate</span>
                    </button>
                }
            </div>

            <div class="edit-info">
                <span class="info-icon">‚ÑπÔ∏è</span>
                <span class="info-text">Your changes will replace the current translation</span>
            </div>
        </div>
    }
</div>

@code {
    [Parameter]
    public string Text { get; set; } = string.Empty;

    [Parameter]
    public bool IsEditMode { get; set; }

    [Parameter]
    public EventCallback OnEnterEdit { get; set; }

    [Parameter]
    public EventCallback<string> OnSaveEdit { get; set; }

    [Parameter]
    public EventCallback OnCancelEdit { get; set; }

    [Parameter]
    public EventCallback OnRetranslateRequested { get; set; }

    [Parameter]
    public bool ShowRetranslate { get; set; } = true;

    private string EditedText { get; set; } = string.Empty;

    protected override void OnParametersSet()
    {
        if (IsEditMode && string.IsNullOrWhiteSpace(EditedText))
        {
            EditedText = Text;
        }
    }

    private async Task OnDoubleClick()
    {
        if (!IsEditMode && !string.IsNullOrWhiteSpace(Text))
        {
            EditedText = Text;
            await OnEnterEdit.InvokeAsync();
        }
    }

    private async Task OnSave()
    {
        if (!string.IsNullOrWhiteSpace(EditedText))
        {
            await OnSaveEdit.InvokeAsync(EditedText);
        }
    }

    private async Task OnCancel()
    {
        EditedText = string.Empty;
        await OnCancelEdit.InvokeAsync();
    }

    private async Task OnRetranslate()
    {
        EditedText = string.Empty;
        await OnRetranslateRequested.InvokeAsync();
    }
}
